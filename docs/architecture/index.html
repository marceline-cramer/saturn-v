<!DOCTYPE html>
<html lang="en" >

<head>
    <meta charset="UTF-8"><meta http-equiv="Content-Security-Policy"
content="default-src 'self';font-src &#x27;self&#x27; data: 'self';img-src &#x27;self&#x27; https:&#x2F;&#x2F;* data:;style-src &#x27;self&#x27; 'unsafe-inline';frame-src player.vimeo.com https:&#x2F;&#x2F;www.youtube-nocookie.com;connect-src 'self';script-src 'self' 'self' 'wasm-unsafe-eval'">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="base" content="https://marceline-cramer.github.io/saturn-v">

    
    <title>
Saturn V ‚Ä¢ Saturn V's Architecture</title>

    
    
    
        <link rel=icon href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y="50%" x="50%" dominant-baseline="central" text-anchor="middle" font-size="88">ü™ê</text></svg>'>
    

    
    

    
    
    
        
            <link rel="stylesheet" href="https://marceline-cramer.github.io/saturn-v/custom_subset.css?h=0b9535a28bc3d5bf2321">
        
    

    
        <link rel="stylesheet" href="https://marceline-cramer.github.io/saturn-v/main.css?h=fe8c9607d92b0cda0f8f" />
        <link rel="stylesheet" href="https://marceline-cramer.github.io/saturn-v/css/custom.css?h=1f784d19972d052a46f7" />

    <meta name="color-scheme" content="light dark" />
        <meta name="description" content="" />
        <meta property="og:description" content="" />

    

    <meta property="og:title" content="Saturn V's Architecture" />
    <meta property="og:type" content="article" />

    
<meta property="og:locale" content="en_GB" />

    <meta property="og:url" content="https:&#x2F;&#x2F;marceline-cramer.github.io&#x2F;saturn-v&#x2F;docs&#x2F;architecture&#x2F;" /><meta property="og:site_name" content="Saturn V">
        <noscript><link rel="stylesheet" href="https://marceline-cramer.github.io/saturn-v/no_js.css"/></noscript>
        <script type="text/javascript" src="https://marceline-cramer.github.io/saturn-v/js/initializeTheme.min.js"></script>
        <script defer src="https://marceline-cramer.github.io/saturn-v/js/themeSwitcher.min.js"></script><script defer src="https://marceline-cramer.github.io/saturn-v/search_index.en.js?h=9ec8896551e6db358ee5"></script>
        <script defer src="https://marceline-cramer.github.io/saturn-v/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e"></script>

        
    
</head>


<body>
    <header>
    <nav class="navbar">
        <div class="nav-title">
            <a class="home-title" href="https://marceline-cramer.github.io/saturn-v">Saturn V</a>
        </div>
            <div class="nav-navs">
                <ul>
                        
                            <li>
                                <a class="nav-links no-hover-padding" href="https://marceline-cramer.github.io/saturn-v/docs/">Docs
                                </a>
                            </li>
                        
                            <li>
                                <a class="nav-links no-hover-padding" href="https://marceline-cramer.github.io/saturn-v/blog/">Blog
                                </a>
                            </li>
                        
                            <li>
                                <a class="nav-links no-hover-padding" href="https:&#x2F;&#x2F;discord.gg&#x2F;apTv6WEhpn">Discord
                                </a>
                            </li>
                        
                            <li>
                                <a class="nav-links no-hover-padding" href="https:&#x2F;&#x2F;github.com&#x2F;marceline-cramer&#x2F;saturn-v">GitHub
                                </a>
                            </li>
                        <li class="menu-icons-container">
                        <ul class="menu-icons-group">
                            <li class="js menu-icon">
                                <div role="button" tabindex="0" id="search-button" class="search-icon interactive-icon" title="Click or press $SHORTCUT to open search" aria-label="Click or press $SHORTCUT to open search">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960">
                                        <path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/>
                                    </svg>
                                </div>
                            </li>

                            
                            

                            <li class="theme-switcher-wrapper js"><div
        title="Toggle dark&#x2F;light mode"
        class="theme-switcher"
        tabindex="0"
        role="button"
        aria-label="Toggle dark mode"
        aria-pressed="false">
    </div><div
        title="Reset mode to default"
        class="theme-resetter arrow"
        tabindex="0"
        role="button"
        aria-hidden="true"
        aria-label="Reset mode to default">
    </div>

</li>
</ul>
                    </li>
                </ul>
            </div>
        
    </nav>
</header>

    <div class="content">

        
        




<main>
    <article class="h-entry">
        <h1 class="p-name article-title">
            Saturn V's Architecture
        </h1>
        <a class="u-url u-uid" href="https://marceline-cramer.github.io/saturn-v/docs/architecture/"></a>

        <ul class="meta"><span class="hidden p-author h-card">
<a rel="author" href="https:&#x2F;&#x2F;marceline-cramer.github.io&#x2F;saturn-v" class="u-url " title=""></a>
</span>
<li title="584 words">3 min read</li>
        </ul><section class="e-content body">

<noscript>
    <strong>‚ö†Ô∏è JavaScript is required to render the diagram.</strong>
</noscript>
<pre class="mermaid invertible-image">
    flowchart LR
    subgraph Frontend
        TypeInfer["Type-infer"]
        Parse --> TypeInfer
        TypeInfer --> Desugar
        Desugar --> Lower
        Lower --> Check
    end
    subgraph Backend
        Check --> Evaluate
        Evaluate --> Solve
    end
</pre>
<ul>
<li><strong>parse</strong>: Saturn V incrementally parses updates to Kerolox source files using <a rel="external" href="https://tree-sitter.github.io/">tree-sitter</a>, then loads the resulting syntax trees into incremental <a rel="external" href="https://salsa-rs.github.io/salsa/">Salsa</a> data structures. This is the source of all the inputs to the incremental frontend.</li>
<li><strong>type-infer</strong>: Kerolox programs are type-inferred at a high level using explicit relation definitions and type constraint rules applied on the expression levels. This gives every variable and expression in a program a concrete type and reports error diagnostics when types are inconsistent or unknown.</li>
<li><strong>desugar</strong>: The typing information is used by Saturn V to desugar the Kerolox types and values into Saturn V's intermediate representation (IR). For example, tuple types are flattened into lists of primitive values. All Saturn V relations ultimately end up as flat relations with columns of only primitive types.</li>
<li><strong>lower</strong>: Although desugaring has transformed the logical representation of Kerolox of semantics into IR, the IR is still purely logical and does not instruct Saturn V how to operate on relations to meet those semantics. The program's IR is fed into <a rel="external" href="https://github.com/egraphs-good/egglog">egglog</a>, a state-of-the-art <a rel="external" href="https://en.wikipedia.org/wiki/E-graph">equality graph (e-graph)</a> implementation, to extract an equivalent relational program that can be actually be executed. The relational program is represented as a forest of <a rel="external" href="https://en.wikipedia.org/wiki/Datalog">bottom-up</a> relational operations.</li>
<li><strong>check</strong>: Some undesirable or unexpected properties of programs such as infinite recursion or unused relations can be detected using <a rel="external" href="https://github.com/Z3Prover/z3">Z3</a>'s <a rel="external" href="https://microsoft.github.io/z3guide/docs/fixedpoints/intro">fixed-point engine</a>. This can provide warning diagnostics to users as they write programs, but in the future, it may also be used to ensure the safety of untrusted Saturn V programs before running them. Z3's fixed-point features are designed to check program safety in procedural environments, but luckily, we're already in a Horn clause-based system! It's a match made in heaven.</li>
<li><strong>evaluate</strong>: Now that the IR describes concrete relational operations instead of pure logical relations, it is passed to a <a rel="external" href="https://github.com/TimelyDataflow/differential-dataflow">Differential Dataflow</a> engine that incrementally populates the contents of each relation. It also assembles a model of the logical relationships between each entry in the program's decision relations. These relationships are eventually gathered in the top-level constraint operations, which emit constraints on decision values in propositional logic.</li>
<li><strong>solve</strong>: The constraints, set of active decisions, and logical relations are passed to a decoupled solving engine, which uses a <a rel="external" href="https://en.wikipedia.org/wiki/SAT_solver">SAT solver</a> to select decisions which meet all of the constraints. Because the evaluation engine's output is incremental, the solving engine's SAT instance can be kept across updates and extended with minor changes to inputs, responding with low latency instead of solving the program from scratch.</li>
</ul>
<p>The steps of the pipeline between "parse" and "check" can be considered the "frontend" of Saturn V, because they reason about Kerolox programs without evaluating them or making any decisions. The Saturn V "backend" is composed of the evaluation and solve steps, which run separately and can be asynchronously loaded with new, valid IR code. In other words, the Saturn V frontend is everything that runs in a language server or IDE, and the backend runs long-term on a dedicated server machine and is dynamically loaded with new code over time.</p>

        </section>

        
        
        

        
            
            
            

            
        
            
            
            

            
        
            
            
            

            
        
            
            
            

            
        
        </article>
</main>


<script defer src="https://marceline-cramer.github.io/saturn-v/js/mermaid.min.js"></script><span id="copy-success" class="hidden">
        Copied!
    </span>
    <span id="copy-init" class="hidden">
        Copy code to clipboard
    </span>
    <script defer src="https://marceline-cramer.github.io/saturn-v/js/copyCodeToClipboard.min.js"></script>

<script defer src="https://marceline-cramer.github.io/saturn-v/js/footnoteBacklinks.min.js"></script>
    </div>
    <footer>
    <section>
        <nav class="socials nav-navs">
        </nav>

        
        <nav class="nav-navs">
        </nav>

        <div class="credits">
            <small>
                

                
                Powered by
                <a rel="" 

 href="https://www.getzola.org">Zola</a>
                &amp;
                <a rel="" 

 href="https://github.com/welpo/tabi">tabi</a>

                </small>
        </div>
    </section>

    <div id="searchModal" class="search-modal js" role="dialog" aria-labelledby="modalTitle">
    <h1 id="modalTitle" class="visually-hidden">Search</h1>
    <div id="modal-content">
        <div id="searchBar">
            <div class="search-icon" aria-hidden="true">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960">
                    <path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/>
                </svg>
            </div>
            <input id="searchInput" role="combobox" autocomplete="off" spellcheck="false" aria-expanded="false" aria-controls="results-container" placeholder="Search‚Ä¶"/>
            <div id="clear-search" class="close-icon interactive-icon" tabindex="0" role="button" title="Clear search">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960">
                <path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/>
                </svg>
            </div>
        </div>
        <div id="results-container">
            <div id="results-info"><span id="zero_results"> No results</span>
                <span id="one_results"> $NUMBER result</span>
                <span id="many_results"> $NUMBER results</span><span id="two_results"> $NUMBER results</span>
                <span id="few_results"> $NUMBER results</span>
            </div>
            <div id="results" role="listbox"></div>
        </div>
    </div>
</div>
</footer>


    
    
</body>

</html>
